<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Form Segnalazione Call Center</title>
  <link rel="stylesheet" href="webToCaseStyle.css" />

  <script src="https://unpkg.com/i18next@22.4.10/i18next.min.js"></script>
  <!-- PRIMA Popper.js -->
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <!-- POI Tippy.js -->
  <script src="https://unpkg.com/tippy.js@6"></script>
<script src="https://www.google.com/recaptcha/api.js"></script>
<script>

 function timestamp() { var response = document.getElementById("g-recaptcha-response"); if (response == null || response.value.trim() == "") {var elems = JSON.parse(document.getElementsByName("captcha_settings")[0].value);elems["ts"] = JSON.stringify(new Date().getTime());document.getElementsByName("captcha_settings")[0].value = JSON.stringify(elems); } } setInterval(timestamp, 500); 
</script>
  <script src="webToCaseUtils.js"></script>
 
<script>
     var lang;
      let t;
  var aziendaId;

    const requiredFields = [

      "nome",
      "cognome",
      "nazione",
  
      "indirizzo",

      "mail",
      "prefissotelefonico",
      "numerotelefonico",
      "accounttpl",
      "tipoproblema",
      "dataoraevento",
 
      "descrizione"

];
  

     const resources = {
  it: {
    translation: {
      labels: {
        legendanagrafica:"DATI ANAGRAFICI DELLA PERSONA CHE SEGNALA IL PROBLEMA",
        erroreCampoObbligatorio: "Devi compilare questo campo",
        seleziona: "--Seleziona--",
        nome:"Nome",
        cognome:"Cognome",
        nazione:"NazionalitÃ ",
        indirizzo:"Indirizzo di residenza (via, piazza, corso, nÂ° civico",
        comune:"Comune",
        citta:"CittÃ ",
        localita:"LocalitÃ ",
        cap:"CAP",
        provincia:"Provincia",
        mail:"E-mail",
        abbonatosino:"Abbonato",
        numerotesserinoidentificativo:"Numero di tesserino identificativo Tpl Fvg (se ne sei titolare)",

        legendadaticontatto:"INFORMAZIONI SUL CONTATTO",
        prefissotelefonico:"Prefisso telefonico internazionale del numero d cui si Ã¨ contattato il call center",
        numerotelefonico:"Numero di telefono da cui si Ã¨ contattato il call center",
        dataoraevento:"Data e ora in cui il contatto Ã¨ avvenuto",
        accounttpl:"A quale azienda si riferiva la tua chiamata?",
        tipoproblema:"Quale problema hai riscontrato?",
        tipoproblemaOptions: ["--Seleziona--", 
                              "Tempi di attesa troppo lunghi", 
                              "Non sono riuscito a parlare con un operatore", 
                              "La chiamata Ã¨ stata interrotta prima della conclusione",
                              "Lâ€™operatore non mi ha fornito assistenza o non ha saputo rispondere alla mia richiesta",
                              "Lâ€™operatore mi ha dato una risposta sbagliata o incompleta",
                              "Lâ€™operatore Ã¨ stato scortese o poco professionale",
                              "Altro"                              
                             ],
        descrizione:"Descrizione dell'evento",
        introdescrizione:"Descrivi il problema in modo sintetico ma completo, fornendo tutte le informazioni utili per la ricostruzione della chiamata. Se desideri allegare immagini, titoli di viaggio o altri documenti utili, potrai farlo rispondendo alla e-mail di notifica che riceverai dopo aver compilato questo form.",
        invia:"Invia segnalazione",
        ultimo:""
      },
      tooltips: {
        dataoraevento:"Se non ricordi con esattezza la data e lâ€™ora del contatto, indica un dato approssimativo: ci aiuterÃ  a risalire alla chiamata",
        accounttpl:"Indica lâ€™azienda a cui era riferita la tua chiamata: se non la conosci, o se la chiamata riguardava servizi non riconducibili a una singola azienda consorziata, seleziona lâ€™opzione TPL FVG",
        numerotesserinoidentificativo:`<div>
          Ãˆ il numero di sette cifre che identifica in modo univoco il cliente abbonato: si trova sia sul tesserino identificativo, sia sugli abbonamenti acquistati utilizzando quel tesserino.<br/>
          <img src="abbonamento_tipo.png" alt="Tesserino esempio"style="max-width: 100%; height: auto;"/>
        </div>`,
        ultimo:""
      }
    }
  },
  en: {
    translation: {
      labels: {
        legendanagrafica:"PERSONAL DETAILS OF THE PERSON REPORTING THE ISSUE",
        erroreCampoObbligatorio: "You must fill this field",
        seleziona: "--Select--",
        nome:"First Name",
        cognome:"Last Name",
        nazione:"Country",
        indirizzo:"Address (street, square, avenue, number) ",
        comune:"Municipality",
        citta:"City",
        localita:"Locality",
        cap:"Zip Code",
        provincia:"Province",
        mail:"E-mail",
        abbonatosino:"Pass holder",
        numerotesserinoidentificativo:"Tpl Fvg identification card number (if the complainant holds one)",

        legendadaticontatto:"CONTACT INFORMATION",
        prefissotelefonico:"International telephone prefix of the number used to contact the call center",
        numerotelefonico:"Phone number used to contact the call center ",
        dataoraevento:"Date and time of contact",
        accounttpl:"Which company was your call regarding?",
          

        tipoproblema:"What problem did you encounter?",
        tipoproblemaOptions: ["--Select--", 
                              "Waiting times were too long", 
                              "I was unable to speak with an operator", 
                              "The call was disconnected before it was completed",
                              "The operator did not assist me or was unable to answer my request",
                              "The operator gave me an incorrect or incomplete response",
                              "The operator was rude or unprofessional",
                              "Other"
                             ],
        descrizione:"Description of the event",
        introdescrizione:"Please describe the issue briefly but thoroughly, providing all information useful for reconstructing the call. If you wish to attach images, travel tickets, or other relevant documents, you can do so by replying directly to the notification e-mail you will receive after submitting this form.",
        invia:"Report issue",

        ultimo:""

      },
      tooltips: {
        dataoraevento:"If you donâ€™t remember the exact date and time of the contact, please provide an approximate one: it will help us trace the call.",
        accounttpl:"Select the company your call referred to. If you're not sure, or if the call concerned services not attributable to a specific consortium company, select the TPL FVG option",
        numerotesserinoidentificativo:`<div>
          It is the seven-digit number that uniquely identifies the subscriber: you can find it both on the identification card and on the subscriptions purchased using that card.<br/>
          <img src="abbonamento_tipo.png" alt="Tesserino esempio"style="max-width: 100%; height: auto;"/>
        </div>`,
        ultimo:""



      }
    }
  }
};


    const comuneListId = "comuniList";
    const nazioniListId = "nazioniList";
    const campoNazioneId = "00NbU0000001klm";

  var fields = [];
  function attivaDebugSubmit() {
  const campiDebug = [
    "00NbU0000001kln", // nome
    "00NbU0000001klf", // cognome
    "email",           // email
    "description",     // descrizione
    "orgid", "retURL", "debug", "debugEmail"
  ];

  const form = document.getElementById("formReclamo");
  Array.from(form.elements).forEach(el => {
    if (!campiDebug.includes(el.name)) {
      el.removeAttribute("name");
    }
  });
}






   //carica tipo problema     
  function caricaTipoProblema() {
  const selectTipoSoggetto = document.getElementById("00NbU0000003VIb");
  selectTipoSoggetto.innerHTML = "";
  const options = t("labels.tipoproblemaOptions", { returnObjects: true });

  options.forEach((opt, index) => {
    const optionEl = document.createElement("option");
    optionEl.textContent = opt;
    optionEl.value = opt;



    selectTipoSoggetto.appendChild(optionEl);
  });
     
}


    document.addEventListener("DOMContentLoaded", () => {

      fields = estraiCampiDaLabel();

       lang = new URLSearchParams(location.search).get("lang") || "it";

      i18next.init({ lng: lang, resources }, (_, tInstance) => {
          t = tInstance; // ðŸ‘ˆ assegna t a una variabile globale
          aggiornaEtichette(t, fields);

         const comuniNazioniUrl = "https://tplfvg.my.salesforce-sites.com/forms/resource/ComuniNazioni";
         const aziendeTplUrl="https://tplfvg.my.salesforce-sites.com/forms/resource/AziendeTPL_json";
         const serviziUrl = "https://tplfvg.my.salesforce-sites.com/forms/services/apexrest/Servizi";
         const lineeUrl = "https://tplfvg.my.salesforce-sites.com/forms/services/apexrest/Linee?servizioId=";
         const fermateUrl= "https://tplfvg.my.salesforce-sites.com/forms/services/apexrest/LineeFermate?lineaId=";
         const prefissiUrl ="https://form-tpl-final.glitch.me/prefissi.json"

        caricaPrefissiTelefonici("00NbU0000002837", prefissiUrl, t);
        caricaDatalistComuniENazioni(comuniNazioniUrl, lang, comuneListId, nazioniListId, campoNazioneId);
        caricaAziendeTPL("00NbU0000002bl3", aziendeTplUrl, t);

   

   

     

        document.getElementById("00NbU0000001klm")?.addEventListener("change", () => {
          toggleIndirizzo("00NbU0000001klm", "indirizzoItaliaWrapper", lang);
          toggleIndirizzo("00NbU0000001klm", "indirizzoEsteroWrapper", lang, true);
        });






       
        caricaTipoProblema();



        document.getElementById("languageSwitcher")?.addEventListener("change", e => {
          const newLang = e.target.value;
          lang = newLang;
          i18next.changeLanguage(newLang, () => {
            const newT = i18next.t.bind(i18next);
            aggiornaEtichette(newT, fields);
            caricaDatalistComuniENazioni(comuniNazioniUrl, newLang, comuneListId, nazioniListId, campoNazioneId);
            const aziendaId = document.getElementById("00NbU0000002bl3").value;
            
            caricaTipoProblema();
          });
        });

        document.getElementById("formReclamo")?.addEventListener("submit", e => {
          //attivaDebugSubmit(); // <<<< Abilita solo alcuni campi


          if (!validazioneCampiObbligatori("formReclamo", t)) {
            e.preventDefault();
          }
          formattaDataEvento("data_evento_visible", "00NbU0000001klh");
 


          const validCampi = validazioneCampiObbligatori("formReclamo", t);

          const validCaptcha = validaCaptcha(t, "captchaError");

          if (!validCampi || !validCaptcha) {
            e.preventDefault();
            return;
          }


        });
      });
    });
  </script>
</head>
<body>
  <div class="form-container">
      <select id="languageSwitcher">
        <option value="it">ðŸ‡®ðŸ‡¹ Italiano</option>
        <option value="en">ðŸ‡¬ðŸ‡§ English</option>
      </select>
    <br>
      <form id="formReclamo"   method="POST" action="https://webto.salesforce.com/servlet/servlet.WebToCase?encoding=UTF-8&orgId=00D06000001Tz0T" novalidate>

        <input type="hidden" name="orgid" value="00D06000001Tz0T" />
        <input
          type="hidden"
          name="retURL"
          value=""
        />


        <input type="hidden" name="captcha_settings" value='{"keyname":"captchatplv2","fallback":"true","orgId":"00D06000001Tz0T","ts":""}'>


       <input type="hidden" name="debug" value="1">
        <input type="hidden" name="debugEmail" value="p.santin@e-deimos.it">

        <fieldset>
             <legend><span id="label_legendanagrafica"></span></legend>

              <label for="00NbU0000001kln" id="label_nome" ></label>
              <input id="00NbU0000001kln" name="00NbU0000001kln" type="text" />


              <label for="00NbU0000001klf" id="label_cognome" ></label>
              <input id="00NbU0000001klf" name="00NbU0000001klf" type="text" />



    




              <label for="00NbU0000001klm" id="label_nazione" ></label>
              <input id="00NbU0000001klm" name="00NbU0000001klm" list="nazioniList" />
              <datalist id="nazioniList"></datalist>



                <label for="00NbU0000001kli" id="label_indirizzo" ></label>
                  <input id="00NbU0000001kli" name="00NbU0000001kli" type="text" />                

          <div id="indirizzoItaliaWrapper">


                  <label for="00NbU0000001klg" id="label_comune" >Comune:</label>
                  <input id="00NbU0000001klg" name="00NbU0000001klg" list="comuniList" />
                  <datalist id="comuniList"></datalist>


          </div>

          <div id="indirizzoEsteroWrapper" style="display:none">



              <label for="00NbU0000003Id7" id="label_citta"></label>
              <input  id="00NbU0000003Id7" maxlength="255" name="00NbU0000003Id7" size="20" type="text" />


              <label for="00NbU0000003Iej" id="label_localita"></label>
              <input  id="00NbU0000003Iej" maxlength="255" name="00NbU0000003Iej" size="20" type="text" />


              <label for="00NbU0000001kld" id="label_cap"></label>
              <input  id="00NbU0000001kld" maxlength="20" name="00NbU0000001kld" size="20" type="text" />


              <label for="00NbU0000001klp" id="label_provincia"></label>
              <input  id="00NbU0000001klp" maxlength="100" name="00NbU0000001klp" size="20" type="text" />


          </div>



          



               <label for="email" id="label_mail" >Email:</label> 
              <input  id="email" maxlength="80" name="email" size="20"  />


                     <label for="00NbU0000002yEb" id="label_abbonatosino">Reclamo Abbonato si/no:</label>
                     <select  id="00NbU0000002yEb" name="00NbU0000002yEb" title="Reclamo Abbonato si/no">
                       <option value="">--None--</option>
                       <option value="Si/Yes">Si/Yes</option>
                     <option value="No">No</option>
                     </select><br>

                         <label for="00NbU0000001kls" id="label_numerotesserinoidentificativo"></label>
                         <input id="00NbU0000001kls" name="00NbU0000001kls" type="text" />




        </fieldset>

        <fieldset>
          <legend>
            <span id="label_legendadaticontatto"></span>
          </legend>

          <label for="00NbU0000002837" id="label_prefissotelefonico" ></label>
                  <select  id="00NbU0000002837"  name="00NbU0000002837"  >
                  </select>

          <label for="00NbU0000001klo" id="label_numerotelefonico" ></label>
          <input id="00NbU0000001klo" name="00NbU0000001klo" type="text" />




          



               <label for="00NbU0000002bl3" id="label_accounttpl" >
              </label>
              <select id="00NbU0000002bl3" name="00NbU0000002bl3">

              </select>



          


                <label for="data_evento_visible" id="label_dataoraevento"></label>
                <input id="data_evento_visible" type="datetime-local" />
                <input id="00NbU0000001klh" name="00NbU0000001klh" size="20" type="text" style="display:none;" />


          


              




     
          <label for="00NbU0000003VIb" id="label_tipoproblema"></label   >   
          <select  id="00NbU0000003VIb"  name="00NbU0000003VIb"  >
          </select>







                <label for="description" id="label_descrizione"></label>
                <em>
                    <span id='label_introdescrizione'></span>
                </em>
                  <textarea id="description" name="description" rows="10" maxlength="30000"></textarea>

         </fieldset>








        <!--flag segnalazione call center-->
        <input
          id="00NbU0000003VGz"
          name="00NbU0000003VGz"
          type="hidden"
          value="1"
        />

        <input type="hidden"  id="external" name="external" value="1" />

    



        <br>
        <br>
        <br>
        <div class="g-recaptcha" data-sitekey="6LcKTugqAAAAAB9mkWg5p3floGYNeNVAXY6Z6c8P"></div>
        <div id="captchaError" class="error-message" style="display: none;"></div>


        <input type="submit" id="submitBtn" value="Invia Reclamo" />
      </form>
    </div>
</body>
</html>
